<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>QuizBux - Earn Money Online</title>
  <style>
    body { margin:0; padding:0; background:#f0f2f5; font-family:Arial, sans-serif; }
    #loading { position:fixed; inset:0; background:linear-gradient(135deg,#667eea,#764ba2); color:white; display:flex; flex-direction:column; align-items:center; justify-content:center; font-size:2em; gap:20px; z-index:9999; }
    .spinner { width:60px; height:60px; border:8px solid #ffffff33; border-top:8px solid white; border-radius:50%; animation:spin 1s linear infinite; }
    @keyframes spin { to { transform:rotate(360deg); } }
  </style>
</head>
<body>

  <div id="loading">
    <div class="spinner"></div>
    <div>Loading QuizBux...</div>
  </div>

  <div id="app" style="display:none; min-height:100vh;"></div>

  <script>
    // PASTE YOUR DEPLOYED WEB APP URL HERE
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycby9fU6WDfnulZXufa34vvbMBng432TghqRaixhdhq_seHgLUaC74PNoCAk7pccvuwFYPg/exec"; // CHANGE THIS!

    async function startQuizBux() {
      try {
        const resp = await fetch(`${SCRIPT_URL}?action=getConfig`);
        const config = await resp.json();

        if (config.status !== 'success') throw new Error('Failed to load site config');

        // Inject CSS
        const style = document.createElement('style');
        style.textContent = config.styles || '';
        document.head.appendChild(style);

        // Build full page
        document.getElementById('app').innerHTML = `
        <div class="container">
          <div class="header">
            <img src="${config.logo || 'https://via.placeholder.com/200x60/4dccff/ffffff?text=QUIZBUX'}" alt="Logo" id="siteLogo" style="height:60px;margin-bottom:15px;">
            <h1>${config.texts?.welcome_message || 'QuizBux'}</h1>
            <p>${config.texts?.tagline || 'Earn real money online'}</p>
          </div>

          <div class="nav">
            <button class="nav-btn active" data-tab="login">Login</button>
            <button class="nav-btn" data-tab="dashboard">Dashboard</button>
            <button class="nav-btn" data-tab="offers">Offers</button>
            <button class="nav-btn" data-tab="offerwalls">Offerwalls</button>
            <button class="nav-btn" data-tab="work">Submit Work</button>
            <button class="nav-btn" data-tab="cashout">Cashout</button>
            <button class="nav-btn hidden" id="logoutBtn">Logout</button>
          </div>

          <div class="content">
            <div id="alert" class="alert hidden"></div>

            <div id="loginTab" class="tab-content">
              <div class="card">
                <h3>${config.texts?.login_title || 'Login'}</h3>
                <div class="form-group"><input type="text" id="username" class="form-control" placeholder="${config.texts?.username_placeholder || 'Username'}"></div>
                <div class="form-group"><input type="password" id="password" class="form-control" placeholder="${config.texts?.password_placeholder || 'Password'}"></div>
                <button class="btn" id="loginBtn">Login</button>
              </div>
            </div>

            <div id="dashboardTab" class="tab-content hidden">
              <div class="balance-card">
                <h3>Welcome back, <span id="welcomeUser">User</span>!</h3>
                <div class="balance-amount"><span id="userBalance">0</span> Points</div>
                <div class="balance-amount">$<span id="userBalanceUSD">0.00</span> USD</div>
              </div>
            </div>

            <div id="offersTab" class="tab-content hidden">
              <div class="card"><h3>Available Offers</h3><div id="offersContainer" class="offer-grid"></div></div>
            </div>

            <div id="offerwallsTab" class="tab-content hidden">
              <div class="card"><h3>Offerwalls</h3><div id="offerwallsContainer" class="offer-grid"></div></div>
            </div>

            <div id="workTab" class="tab-content hidden">
              <div class="card">
                <h3>Submit Work</h3>
                <textarea id="workSubmission" class="form-control" rows="6" placeholder="${config.texts?.work_placeholder || 'Paste proof or describe work...'}"></textarea>
                <button class="btn" id="submitWorkBtn">Submit Work</button>
              </div>
            </div>

            <div id="cashoutTab" class="tab-content hidden">
              <div class="card">
                <h3>Cashout Rewards</h3>
                <input type="text" id="cashoutReward" class="form-control" placeholder="${config.texts?.cashout_reward_placeholder || 'PayPal, Amazon, etc.'}">
                <input type="number" step="0.01" id="cashoutAmount" class="form-control" placeholder="${config.texts?.cashout_amount_placeholder || 'Amount in USD'}">
                <button class="btn" id="cashoutBtn">Request Cashout</button>
              </div>
            </div>
          </div>

          <div class="footer">
            <p>${config.texts?.footer_text || 'QuizBux Â© 2025'}</p>
            <p style="font-size:0.9em;color:#888;">${config.texts?.terms || ''}</p>
          </div>
        </div>`;

        // Remove loading screen
        document.getElementById('loading').remove();
        document.getElementById('app').style.display = 'block';

        // Inject the main JS (from your Scripts sheet)
        const script = document.createElement('script');
        script.textContent = config.scripts.replace(/ScriptApp\.getService\(\)\.getUrl\(\)/g, `"${SCRIPT_URL}"`);
        document.body.appendChild(script);

      } catch (e) {
        document.getElementById('loading').innerHTML = `<div style="text-align:center;color:white;">
          <h2>Connection Failed</h2>
          <p>Make sure you replaced SCRIPT_URL with your real web app URL</p>
          <button onclick="location.reload()" style="padding:12px 24px;margin-top:20px;">Retry</button>
        </div>`;
      }
    }

    // Start the app
    startQuizBux();
  </script>
</body>
</html>
