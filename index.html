<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Insignia - Premium Rewards Platform</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    :root {
        /* Modern Dark Luxury Color Palette */
        --bg-primary: #0a0a0f;
        --bg-secondary: #111118;
        --bg-tertiary: #1a1a24;
        --bg-card: rgba(30, 30, 40, 0.7);
        --bg-card-hover: rgba(40, 40, 55, 0.8);
        --bg-gradient: linear-gradient(135deg, #0a0a0f 0%, #151522 50%, #0f0f1a 100%);
        --bg-pattern: 
            radial-gradient(circle at 15% 50%, rgba(120, 119, 198, 0.03) 0%, transparent 50%),
            radial-gradient(circle at 85% 30%, rgba(255, 119, 198, 0.02) 0%, transparent 50%),
            linear-gradient(135deg, transparent 60%, rgba(120, 119, 255, 0.03) 100%);
        
        /* Accent Colors */
        --accent-primary: #7877ff;
        --accent-secondary: #ff77c6;
        --accent-tertiary: #5eead4;
        --accent-glow: 0 0 20px rgba(120, 119, 255, 0.4);
        
        /* Status Colors */
        --success: #10b981;
        --warning: #f59e0b;
        --error: #ef4444;
        
        /* Text Colors */
        --text-primary: #f8fafc;
        --text-secondary: #cbd5e1;
        --text-tertiary: #94a3b8;
        
        /* UI Elements */
        --border-radius: 20px;
        --border-radius-sm: 12px;
        --border-radius-lg: 28px;
        --border: 1px solid rgba(255, 255, 255, 0.08);
        --border-accent: 1px solid rgba(120, 119, 255, 0.2);
        --shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        --shadow-lg: 0 32px 64px -16px rgba(0, 0, 0, 0.6);
        --shadow-glow: 0 0 30px rgba(120, 119, 255, 0.3);
        --transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        --backdrop-blur: blur(20px) saturate(180%);
    }

    * { 
        margin: 0; 
        padding: 0; 
        box-sizing: border-box; 
        font-family: 'Inter', sans-serif; 
    }

    body { 
        background: var(--bg-gradient), var(--bg-pattern); 
        color: var(--text-primary); 
        min-height: 100vh; 
        overflow-x: hidden;
        line-height: 1.6;
        font-weight: 400;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 20px;
        /* Prevent text selection and copying */
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
    }

    /* Anti-cheat overlay */
    #antiCheatOverlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        z-index: 9999;
        display: none;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        backdrop-filter: blur(10px);
    }

    .hidden { display: none !important; }

    /* Modern Geometric Patterns */
    .pattern-dots {
        background-image: radial-gradient(rgba(120, 119, 255, 0.1) 1px, transparent 1px);
        background-size: 20px 20px;
    }

    .pattern-grid {
        background-image: 
            linear-gradient(rgba(120, 119, 255, 0.05) 1px, transparent 1px),
            linear-gradient(90deg, rgba(120, 119, 255, 0.05) 1px, transparent 1px);
        background-size: 30px 30px;
    }

    /* Loading Screen */
    #loadingScreen { 
        text-align: center; 
        background: var(--bg-card);
        backdrop-filter: var(--backdrop-blur);
        padding: 60px 40px;
        border-radius: var(--border-radius-lg);
        box-shadow: var(--shadow);
        border: var(--border);
        position: relative;
        overflow: hidden;
    }
    
    #loadingScreen::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
        animation: loadingBar 2s ease-in-out infinite;
    }
    
    @keyframes loadingBar {
        0% { transform: translateX(-100%); }
        50% { transform: translateX(0%); }
        100% { transform: translateX(100%); }
    }
    
    #loadingScreen h2 { 
        font-size: 2.8rem; 
        background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
        -webkit-background-clip: text; 
        background-clip: text;
        color: transparent; 
        margin-bottom: 1rem;
        font-weight: 800;
        letter-spacing: -0.5px;
    }
    
    #loadingScreen p {
        color: var(--text-tertiary);
        font-size: 1.1rem;
    }

    /* Main Container */
    .main-container {
        width: 100%;
        max-width: 1400px;
        margin: 0 auto;
    }

    /* Auth Container */
    .auth-container {
        display: flex;
        gap: 2.5rem;
        max-width: 1100px;
        width: 100%;
    }

    .auth-card {
        flex: 1;
        background: var(--bg-card);
        backdrop-filter: var(--backdrop-blur);
        border-radius: var(--border-radius-lg);
        padding: 3.5rem;
        box-shadow: var(--shadow);
        border: var(--border);
        position: relative;
        overflow: hidden;
        transition: var(--transition);
    }

    .auth-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 5px;
        background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary), var(--accent-tertiary));
        background-size: 200% 100%;
        animation: shimmer 3s ease-in-out infinite;
    }
    
    .auth-card::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, rgba(120, 119, 255, 0.03) 0%, transparent 50%);
        pointer-events: none;
    }

    @keyframes shimmer {
        0%, 100% { background-position: -200% 0; }
        50% { background-position: 200% 0; }
    }

    .auth-card:hover {
        transform: translateY(-8px);
        box-shadow: var(--shadow-glow);
        border: var(--border-accent);
    }

    .auth-card h1 {
        font-size: 2.8rem;
        font-weight: 800;
        background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-secondary) 100%);
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
        margin-bottom: 0.5rem;
        text-align: center;
        letter-spacing: -1px;
    }

    .auth-card p {
        color: var(--text-tertiary);
        margin-bottom: 2.5rem;
        text-align: center;
        font-size: 1.1rem;
        font-weight: 400;
    }

    .auth-input-group {
        position: relative;
        margin-bottom: 2rem;
    }

    .auth-input {
        width: 100%;
        padding: 1.4rem 1.8rem;
        background: rgba(15, 15, 20, 0.7);
        border: var(--border);
        border-radius: var(--border-radius-sm);
        color: var(--text-primary);
        font-size: 1rem;
        transition: var(--transition);
        outline: none;
        font-weight: 400;
        letter-spacing: 0.2px;
    }

    .auth-input:focus {
        border-color: var(--accent-primary);
        box-shadow: 0 0 0 3px rgba(120, 119, 255, 0.2);
        transform: translateY(-2px);
        background: rgba(20, 20, 30, 0.8);
    }

    .auth-input::placeholder {
        color: var(--text-tertiary);
    }

    .auth-btn {
        width: 100%;
        padding: 1.5rem;
        background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-secondary) 100%);
        border: none;
        border-radius: var(--border-radius-sm);
        color: white;
        font-size: 1.1rem;
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
        box-shadow: var(--shadow);
        margin-bottom: 1.5rem;
        letter-spacing: 0.5px;
        position: relative;
        overflow: hidden;
    }

    .auth-btn::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
        transition: left 0.7s;
    }

    .auth-btn:hover::before {
        left: 100%;
    }

    .auth-btn:hover {
        transform: translateY(-4px) scale(1.02);
        box-shadow: var(--shadow-glow);
    }

    .auth-btn:disabled {
        background: #4b5563;
        opacity: 0.6;
        cursor: not-allowed;
        transform: none !important;
    }

    .auth-switch {
        text-align: center;
        color: var(--text-tertiary);
        margin-top: 2rem;
        font-size: 1rem;
    }

    .auth-switch a {
        color: var(--accent-primary);
        text-decoration: none;
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
        position: relative;
    }

    .auth-switch a::after {
        content: '';
        position: absolute;
        bottom: -2px;
        left: 0;
        width: 0;
        height: 2px;
        background: var(--accent-primary);
        transition: width 0.3s ease;
    }

    .auth-switch a:hover::after {
        width: 100%;
    }

    /* Verification Code */
    .verification-code {
        display: flex;
        gap: 1rem;
        justify-content: center;
        margin: 2.5rem 0;
    }

    .code-input {
        width: 65px;
        height: 75px;
        text-align: center;
        font-size: 1.8rem;
        font-weight: 700;
        background: rgba(15, 15, 20, 0.7);
        border: var(--border);
        border-radius: var(--border-radius-sm);
        color: var(--text-primary);
        transition: var(--transition);
        font-family: 'JetBrains Mono', monospace;
    }

    .code-input:focus {
        border-color: var(--accent-primary);
        box-shadow: 0 0 0 3px rgba(120, 119, 255, 0.2);
        transform: scale(1.05);
    }

    /* Header */
    #header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1.8rem 2.5rem;
        background: var(--bg-card);
        backdrop-filter: var(--backdrop-blur);
        border-radius: var(--border-radius-lg);
        margin: 1.5rem 0;
        box-shadow: var(--shadow);
        border: var(--border);
        position: relative;
        overflow: hidden;
    }

    #header::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, rgba(120, 119, 255, 0.03) 0%, transparent 50%);
        pointer-events: none;
    }

    #logo-img {
        height: 55px;
        border-radius: var(--border-radius-sm);
        filter: brightness(1.1);
    }

    .header-buttons {
        display: flex;
        gap: 1rem;
    }

    #header button {
        background: rgba(15, 15, 20, 0.7);
        border: var(--border);
        color: var(--text-primary);
        padding: 0.9rem 1.8rem;
        border-radius: var(--border-radius-sm);
        cursor: pointer;
        transition: var(--transition);
        font-weight: 500;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    #header button:hover {
        background: var(--accent-primary);
        transform: translateY(-3px);
        box-shadow: var(--shadow-glow);
    }

    /* Dashboard */
    .profile {
        display: flex;
        align-items: center;
        gap: 2rem;
        background: var(--bg-card);
        backdrop-filter: var(--backdrop-blur);
        padding: 2.5rem;
        border-radius: var(--border-radius-lg);
        margin: 1.5rem 0;
        box-shadow: var(--shadow);
        border: var(--border);
        position: relative;
        overflow: hidden;
    }

    .profile::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, rgba(120, 119, 255, 0.03) 0%, transparent 50%);
        pointer-events: none;
    }

    .avatar {
        width: 90px;
        height: 90px;
        background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2.2rem;
        font-weight: 700;
        box-shadow: var(--shadow-glow);
        position: relative;
        z-index: 1;
    }

    .user-status {
        display: inline-block;
        padding: 0.4rem 1rem;
        border-radius: 50px;
        font-size: 0.85rem;
        font-weight: 600;
        margin-left: 0.8rem;
    }

    .status-active {
        background: var(--success);
        color: white;
    }

    .status-suspended {
        background: var(--error);
        color: white;
    }

    .balance-container {
        display: flex;
        gap: 2rem;
        margin-top: 1.5rem;
    }

    .balance-item {
        background: rgba(15, 15, 20, 0.7);
        padding: 1.5rem 2rem;
        border-radius: var(--border-radius-sm);
        text-align: center;
        flex: 1;
        border: var(--border);
        transition: var(--transition);
        position: relative;
        overflow: hidden;
    }

    .balance-item::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, rgba(120, 119, 255, 0.05) 0%, transparent 50%);
        pointer-events: none;
    }

    .balance-item:hover {
        transform: translateY(-5px);
        border: var(--border-accent);
        box-shadow: var(--shadow-glow);
    }

    .balance-label {
        font-size: 0.95rem;
        color: var(--text-tertiary);
        margin-bottom: 0.8rem;
        font-weight: 500;
    }

    .balance-value {
        font-size: 1.8rem;
        font-weight: 700;
        color: var(--accent-primary);
        font-family: 'JetBrains Mono', monospace;
    }

    .nav {
        display: flex;
        background: var(--bg-card);
        backdrop-filter: var(--backdrop-blur);
        border-radius: var(--border-radius-lg);
        overflow: hidden;
        margin: 1.5rem 0;
        box-shadow: var(--shadow);
        border: var(--border);
        position: relative;
    }

    .nav::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, rgba(120, 119, 255, 0.03) 0%, transparent 50%);
        pointer-events: none;
    }

    .nav button {
        flex: 1;
        padding: 1.5rem;
        background: transparent;
        border: none;
        color: var(--text-tertiary);
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
        position: relative;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.7rem;
    }

    .nav button i {
        font-size: 1.2rem;
    }

    .nav button:hover, .nav button.active {
        background: linear-gradient(135deg, rgba(120, 119, 255, 0.1), rgba(255, 119, 198, 0.05));
        color: var(--text-primary);
    }

    .nav button.active::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 3px;
        background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
    }

    .page {
        background: var(--bg-card);
        backdrop-filter: var(--backdrop-blur);
        border-radius: var(--border-radius-lg);
        padding: 3rem;
        margin: 1.5rem 0;
        box-shadow: var(--shadow);
        min-height: 500px;
        border: var(--border);
        position: relative;
        overflow: hidden;
    }

    .page::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, rgba(120, 119, 255, 0.03) 0%, transparent 50%);
        pointer-events: none;
    }

    .page h3 {
        font-size: 2rem;
        color: var(--text-primary);
        margin-bottom: 2rem;
        font-weight: 700;
        position: relative;
        display: inline-block;
    }

    .page h3::after {
        content: '';
        position: absolute;
        bottom: -8px;
        left: 0;
        width: 50px;
        height: 4px;
        background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
        border-radius: 2px;
    }

    /* Quiz System Styles */
    .quiz-container {
        background: var(--bg-card);
        backdrop-filter: var(--backdrop-blur);
        border-radius: var(--border-radius-lg);
        padding: 3rem;
        margin: 1.5rem 0;
        box-shadow: var(--shadow);
        border: var(--border);
        position: relative;
        overflow: hidden;
    }

    .quiz-container::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, rgba(120, 119, 255, 0.03) 0%, transparent 50%);
        pointer-events: none;
    }

    .quiz-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
        padding-bottom: 1.5rem;
        border-bottom: var(--border);
    }

    .quiz-progress {
        display: flex;
        gap: 0.5rem;
        margin-bottom: 1.5rem;
    }

    .progress-dot {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.1);
        transition: var(--transition);
    }

    .progress-dot.active {
        background: var(--accent-primary);
        box-shadow: 0 0 10px var(--accent-primary);
    }

    .progress-dot.completed {
        background: var(--success);
    }

    .quiz-question {
        font-size: 1.3rem;
        margin-bottom: 2rem;
        line-height: 1.6;
        padding: 1.5rem;
        background: rgba(15, 15, 20, 0.5);
        border-radius: var(--border-radius-sm);
        border-left: 4px solid var(--accent-primary);
    }

    .quiz-options {
        display: flex;
        flex-direction: column;
        gap: 1rem;
        margin-bottom: 2rem;
    }

    .quiz-option {
        padding: 1.2rem 1.5rem;
        background: rgba(15, 15, 20, 0.7);
        border: var(--border);
        border-radius: var(--border-radius-sm);
        cursor: pointer;
        transition: var(--transition);
        display: flex;
        align-items: center;
        gap: 1rem;
    }

    .quiz-option:hover {
        background: rgba(20, 20, 30, 0.8);
        transform: translateY(-2px);
    }

    .quiz-option.selected {
        background: rgba(120, 119, 255, 0.2);
        border-color: var(--accent-primary);
        box-shadow: 0 0 15px rgba(120, 119, 255, 0.2);
    }

    .quiz-option.correct {
        background: rgba(16, 185, 129, 0.2);
        border-color: var(--success);
    }

    .quiz-option.incorrect {
        background: rgba(239, 68, 68, 0.2);
        border-color: var(--error);
    }

    .option-marker {
        width: 24px;
        height: 24px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.1);
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        font-size: 0.9rem;
    }

    .quiz-option.selected .option-marker {
        background: var(--accent-primary);
    }

    .quiz-option.correct .option-marker {
        background: var(--success);
    }

    .quiz-option.incorrect .option-marker {
        background: var(--error);
    }

    .quiz-navigation {
        display: flex;
        justify-content: space-between;
        margin-top: 2rem;
    }

    .quiz-btn {
        padding: 1rem 2rem;
        background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
        border: none;
        border-radius: var(--border-radius-sm);
        color: white;
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
        display: flex;
        align-items: center;
        gap: 0.7rem;
    }

    .quiz-btn:disabled {
        background: #4b5563;
        opacity: 0.6;
        cursor: not-allowed;
        transform: none !important;
    }

    .quiz-btn:hover:not(:disabled) {
        transform: translateY(-3px);
        box-shadow: var(--shadow-glow);
    }

    .quiz-results {
        text-align: center;
        padding: 2rem;
    }

    .quiz-score {
        font-size: 3rem;
        font-weight: 800;
        background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
        margin: 1rem 0;
    }

    .quiz-feedback {
        font-size: 1.2rem;
        margin-bottom: 2rem;
        color: var(--text-secondary);
    }

    .points-earned {
        display: inline-block;
        padding: 0.5rem 1.5rem;
        background: var(--success);
        color: white;
        border-radius: 50px;
        font-weight: 600;
        margin: 1rem 0;
    }

    .points-lost {
        display: inline-block;
        padding: 0.5rem 1.5rem;
        background: var(--error);
        color: white;
        border-radius: 50px;
        font-weight: 600;
        margin: 1rem 0;
    }

    /* Anti-cheat warning */
    .anti-cheat-warning {
        text-align: center;
        padding: 1rem;
        background: rgba(239, 68, 68, 0.2);
        border: 1px solid var(--error);
        border-radius: var(--border-radius-sm);
        margin-bottom: 1.5rem;
        color: var(--error);
        font-weight: 500;
    }

    /* Timer */
    .quiz-timer {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        background: rgba(15, 15, 20, 0.7);
        padding: 0.7rem 1.2rem;
        border-radius: var(--border-radius-sm);
        border: var(--border);
    }

    .timer-warning {
        color: var(--warning);
        animation: pulse 1s infinite;
    }

    .timer-danger {
        color: var(--error);
        animation: pulse 0.5s infinite;
    }

    @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.7; }
    }

    /* Offerwalls */
    .offerwall-iframe {
        width: 100%;
        height: 650px;
        border: none;
        border-radius: var(--border-radius);
        background: white;
    }

    .offerwall-item {
        background: linear-gradient(135deg, rgba(20, 20, 30, 0.9), rgba(30, 30, 45, 0.9));
        backdrop-filter: var(--backdrop-blur);
        border-radius: var(--border-radius-lg);
        padding: 2.5rem;
        margin: 1.5rem 0;
        border: var(--border);
        box-shadow: var(--shadow);
        transition: var(--transition);
        position: relative;
        overflow: hidden;
    }

    .offerwall-item::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, rgba(120, 119, 255, 0.03) 0%, transparent 50%);
        pointer-events: none;
    }

    .offerwall-item:hover {
        transform: translateY(-8px);
        border: var(--border-accent);
        box-shadow: var(--shadow-glow);
    }

    .offerwall-requirements {
        background: rgba(15, 15, 20, 0.7);
        padding: 1.2rem;
        border-radius: var(--border-radius-sm);
        margin: 1.5rem 0;
        text-align: center;
        border: var(--border);
    }

    .offerwall-requirements.unlocked {
        background: rgba(16, 185, 129, 0.15);
        border: 1px solid var(--success);
    }

    .offerwall-requirements.locked {
        background: rgba(239, 68, 68, 0.15);
        border: 1px solid var(--error);
    }

    .offerwall-buttons {
        display: flex;
        gap: 1.5rem;
        justify-content: center;
        margin-top: 2rem;
    }

    .offerwall-buttons button {
        padding: 1.2rem 2.5rem;
        border: none;
        border-radius: var(--border-radius-sm);
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
        display: flex;
        align-items: center;
        gap: 0.7rem;
    }

    .offerwall-buttons button:first-child {
        background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
        color: white;
    }

    .offerwall-buttons button:last-child {
        background: rgba(15, 15, 20, 0.7);
        border: var(--border);
        color: var(--text-primary);
    }

    .offerwall-buttons button:disabled {
        background: #4b5563;
        opacity: 0.6;
        cursor: not-allowed;
        transform: none !important;
    }

    .offerwall-buttons button:hover:not(:disabled) {
        transform: translateY(-4px);
        box-shadow: var(--shadow-glow);
    }

    .iframe-container {
        position: relative;
        margin: 2rem 0;
        border-radius: var(--border-radius);
        overflow: hidden;
        box-shadow: var(--shadow-lg);
        border: var(--border);
    }

    .close-iframe {
        position: absolute;
        top: 20px;
        right: 20px;
        background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
        color: white;
        border: none;
        border-radius: 50%;
        width: 45px;
        height: 45px;
        cursor: pointer;
        z-index: 1000;
        font-size: 1.3rem;
        font-weight: bold;
        box-shadow: var(--shadow);
        transition: var(--transition);
    }

    .close-iframe:hover {
        transform: scale(1.1);
    }

    /* Cashout Page */
    .cashout-info {
        background: rgba(15, 15, 20, 0.7);
        padding: 2rem;
        border-radius: var(--border-radius);
        margin-bottom: 2rem;
        border-left: 4px solid var(--accent-primary);
        border: var(--border);
    }

    .cashout-info h4 {
        color: var(--accent-primary);
        margin-bottom: 0.8rem;
        font-size: 1.3rem;
        font-weight: 600;
    }

    .cashout-form {
        display: flex;
        flex-direction: column;
        gap: 2rem;
    }

    /* Cashout History */
    .cashout-history {
        margin-top: 3rem;
        background: rgba(15, 15, 20, 0.7);
        border-radius: var(--border-radius-lg);
        padding: 2.5rem;
        border: var(--border);
    }

    .cashout-item {
        background: rgba(20, 20, 30, 0.7);
        border-radius: var(--border-radius);
        padding: 1.8rem;
        margin: 1.2rem 0;
        border-left: 4px solid var(--accent-primary);
        border: var(--border);
        transition: var(--transition);
    }

    .cashout-item:hover {
        transform: translateX(5px);
        border: var(--border-accent);
    }

    .cashout-status {
        display: inline-block;
        padding: 0.4rem 1rem;
        border-radius: 50px;
        font-size: 0.85rem;
        font-weight: 600;
        margin-left: 1rem;
    }

    .status-pending {
        background: var(--warning);
        color: black;
    }

    .status-approved {
        background: var(--success);
        color: white;
    }

    .status-rejected {
        background: var(--error);
        color: white;
    }

    .admin-notes {
        background: rgba(15, 15, 20, 0.7);
        padding: 1rem;
        border-radius: var(--border-radius-sm);
        margin-top: 1rem;
        font-size: 0.9rem;
        color: var(--text-secondary);
        border: var(--border);
    }

    /* Chat System */
    #chatToggle {
        position: fixed;
        bottom: 30px;
        right: 30px;
        width: 70px;
        height: 70px;
        background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
        border: none;
        border-radius: 50%;
        color: white;
        font-size: 1.8rem;
        cursor: pointer;
        box-shadow: var(--shadow-glow);
        z-index: 1000;
        transition: var(--transition);
        display: flex;
        align-items: center;
        justify-content: center;
    }

    #chatToggle:hover {
        transform: scale(1.1) rotate(10deg);
    }

    #chatBox {
        position: fixed;
        bottom: 120px;
        right: 30px;
        width: 380px;
        height: 550px;
        background: var(--bg-card);
        backdrop-filter: var(--backdrop-blur);
        border-radius: var(--border-radius-lg);
        box-shadow: var(--shadow-lg);
        border: var(--border);
        display: flex;
        flex-direction: column;
        z-index: 999;
        transition: var(--transition);
    }

    .chat-header {
        background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
        padding: 1.5rem;
        border-radius: var(--border-radius-lg) var(--border-radius-lg) 0 0;
        font-weight: 700;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .chat-close {
        background: none;
        border: none;
        color: white;
        font-size: 1.5rem;
        cursor: pointer;
        transition: var(--transition);
    }

    .chat-close:hover {
        transform: scale(1.2);
    }

    .chat-messages {
        flex: 1;
        padding: 1.5rem;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

    .chat-message {
        background: rgba(15, 15, 20, 0.7);
        padding: 1rem 1.2rem;
        border-radius: var(--border-radius);
        max-width: 80%;
        word-wrap: break-word;
        border: var(--border);
    }

    .chat-message.own {
        background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
        align-self: flex-end;
    }

    .chat-message.other {
        background: rgba(20, 20, 30, 0.7);
        align-self: flex-start;
    }

    .message-sender {
        font-size: 0.85rem;
        font-weight: 600;
        margin-bottom: 0.5rem;
        color: var(--accent-tertiary);
    }

    .chat-input-container {
        padding: 1.5rem;
        border-top: var(--border);
        display: flex;
        gap: 0.8rem;
    }

    .chat-input {
        flex: 1;
        padding: 1rem 1.2rem;
        background: rgba(15, 15, 20, 0.7);
        border: var(--border);
        border-radius: var(--border-radius-sm);
        color: var(--text-primary);
        font-size: 0.95rem;
        resize: none;
        outline: none;
        transition: var(--transition);
    }

    .chat-input:focus {
        border-color: var(--accent-primary);
    }

    .chat-send {
        background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
        border: none;
        border-radius: var(--border-radius-sm);
        color: white;
        width: 50px;
        cursor: pointer;
        transition: var(--transition);
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .chat-send:hover {
        transform: scale(1.05);
    }

    /* Alert Modal */
    #alertModal {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.8);
        backdrop-filter: blur(10px);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 9999;
    }

    #alertModal .modal {
        background: var(--bg-card);
        backdrop-filter: var(--backdrop-blur);
        padding: 3.5rem;
        border-radius: var(--border-radius-lg);
        max-width: 500px;
        text-align: center;
        box-shadow: var(--shadow-lg);
        border: var(--border);
        position: relative;
        overflow: hidden;
    }

    #alertModal .modal::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 5px;
        background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
    }

    #alertModal button {
        margin-top: 2rem;
        padding: 1.2rem 3rem;
        background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
        border: none;
        border-radius: var(--border-radius-sm);
        color: white;
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
    }

    #alertModal button:hover {
        transform: translateY(-3px);
        box-shadow: var(--shadow-glow);
    }

    /* Responsive */
    @media (max-width: 1024px) {
        .auth-container {
            flex-direction: column;
            gap: 1.5rem;
        }
        
        .auth-card {
            padding: 2.5rem;
        }
        
        .balance-container {
            flex-direction: column;
            gap: 1.5rem;
        }
    }

    @media (max-width: 768px) {
        body {
            padding: 15px;
        }
        
        .auth-card {
            padding: 2rem;
        }
        
        .auth-card h1 {
            font-size: 2.2rem;
        }
        
        .verification-code {
            gap: 0.7rem;
        }
        
        .code-input {
            width: 55px;
            height: 65px;
            font-size: 1.5rem;
        }

        #chatBox {
            width: 320px;
            height: 450px;
            right: 20px;
            bottom: 100px;
        }

        .header-buttons {
            flex-direction: column;
            gap: 0.5rem;
        }

        #header button {
            padding: 0.8rem 1.2rem;
            font-size: 0.9rem;
        }

        .profile {
            flex-direction: column;
            text-align: center;
            gap: 1.5rem;
        }

        .nav {
            flex-direction: column;
        }

        .page {
            padding: 2rem;
        }
        
        .offerwall-buttons {
            flex-direction: column;
        }
        
        #chatToggle {
            width: 60px;
            height: 60px;
            font-size: 1.5rem;
            bottom: 20px;
            right: 20px;
        }
        
        .quiz-container {
            padding: 2rem;
        }
        
        .quiz-btn {
            padding: 0.8rem 1.5rem;
        }
    }
  </style>
</head>
<body>

  <!-- Anti-cheat overlay -->
  <div id="antiCheatOverlay">
    <div class="auth-card" style="max-width: 500px; text-align: center;">
      <h1>Security Violation Detected</h1>
      <p>We've detected suspicious activity. The quiz has been terminated.</p>
      <p>Please do not attempt to screenshot, copy content, or use developer tools during the quiz.</p>
      <button class="auth-btn" onclick="closeAntiCheatOverlay()">Return to Dashboard</button>
    </div>
  </div>

  <!-- Loading -->
  <div id="loadingScreen">
    <h2>Loading Insignia</h2>
    <p>Initializing premium experience...</p>
  </div>

  <!-- Main App -->
  <div id="app" class="hidden">
    <div class="main-container">
      <!-- Header -->
      <header id="header">
        <img id="logo-img" src="https://i.postimg.cc/k4pN532x/unnamed-removebg-preview.png" alt="Insignia Logo">
        <div class="header-buttons">
          <button onclick="toggleChat()"><i class="fas fa-comments"></i> Support</button>
          <button onclick="showAlert('Support: premium@insignia.com')"><i class="fas fa-question-circle"></i> Help</button>
          <button onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</button>
        </div>
      </header>

      <!-- Auth Screens -->
      <section id="authScreens">
        <div class="auth-container">
          <!-- Login Card -->
          <div id="loginCard" class="auth-card">
            <h1>Welcome Back</h1>
            <p>Sign in to access your premium account</p>
            <div class="auth-input-group">
              <input type="text" id="loginUsername" class="auth-input" placeholder="Username" autocomplete="off">
            </div>
            <div class="auth-input-group">
              <input type="password" id="loginPassword" class="auth-input" placeholder="Password" autocomplete="off">
            </div>
            <button class="auth-btn" onclick="login()">Access Account</button>
            <div class="auth-switch">
              New to Insignia? <a onclick="showSignup()">Create account</a>
            </div>
          </div>

          <!-- Signup Card -->
          <div id="signupCard" class="auth-card hidden">
            <h1>Join Insignia</h1>
            <p>Create your premium account today</p>
            <div class="auth-input-group">
              <input type="text" id="signupUsername" class="auth-input" placeholder="Choose Username" autocomplete="off">
            </div>
            <div class="auth-input-group">
              <input type="email" id="signupEmail" class="auth-input" placeholder="Email Address" autocomplete="off">
            </div>
            <div class="auth-input-group">
              <input type="password" id="signupPassword" class="auth-input" placeholder="Create Password" autocomplete="off">
            </div>
            <button class="auth-btn" onclick="signup()">Create Premium Account</button>
            <div class="auth-switch">
              Already have an account? <a onclick="showLogin()">Sign in</a>
            </div>
          </div>

          <!-- Verification Card -->
          <div id="verifyCard" class="auth-card hidden">
            <h1>Verify Identity</h1>
            <p>We sent a 6-digit code to your email</p>
            <div class="verification-code">
              <input type="text" class="code-input" maxlength="1" oninput="moveToNext(this, 1)">
              <input type="text" class="code-input" maxlength="1" oninput="moveToNext(this, 2)">
              <input type="text" class="code-input" maxlength="1" oninput="moveToNext(this, 3)">
              <input type="text" class="code-input" maxlength="1" oninput="moveToNext(this, 4)">
              <input type="text" class="code-input" maxlength="1" oninput="moveToNext(this, 5)">
              <input type="text" class="code-input" maxlength="1" oninput="moveToNext(this, 6)">
            </div>
            <button class="auth-btn" onclick="verifyEmail()">Verify & Continue</button>
            <div class="auth-switch">
              Didn't receive code? <a onclick="resendCode()">Resend</a>
            </div>
          </div>
        </div>
      </section>

      <!-- Dashboard -->
      <section id="dashboard" class="hidden">
        <div class="profile">
          <div class="avatar" id="userAvatar">U</div>
          <div>
            <h2 id="displayUsername">User <span id="userStatus" class="user-status status-active">Premium</span></h2>
            <div class="balance-container">
              <div class="balance-item">
                <div class="balance-label">Points Balance</div>
                <div class="balance-value" id="balanceValue">0</div>
              </div>
              <div class="balance-item">
                <div class="balance-label">USD Balance</div>
                <div class="balance-value" id="usdBalanceValue">$0.0000</div>
              </div>
            </div>
          </div>
        </div>

        <nav class="nav">
          <button onclick="showPage('quiz')" class="active"><i class="fas fa-brain"></i> AI Quiz</button>
          <button onclick="showPage('offerwalls')"><i class="fas fa-gem"></i> Offerwalls</button>
          <button onclick="showPage('cashout')"><i class="fas fa-wallet"></i> Cashout</button>
          <button onclick="showPage('terms')"><i class="fas fa-file-contract"></i> Terms</button>
        </nav>

        <div id="pages">
          <!-- Quiz Page -->
          <div id="quiz" class="page">
            <h3>AI-Generated Quiz</h3>
            <div class="anti-cheat-warning">
              <i class="fas fa-shield-alt"></i> Anti-cheat protection is active. Screenshots and developer tools are disabled.
            </div>
            
            <div id="quizIntro" class="quiz-container">
              <h4>How it works</h4>
              <p>Answer two AI-generated questions correctly to earn 10 points and $0.01 USD.</p>
              <p>Each correct answer gives you 5 points, each incorrect answer deducts 5 points.</p>
              <p>You must answer both questions to complete the quiz.</p>
              <button class="auth-btn" onclick="startQuiz()"><i class="fas fa-play"></i> Start Quiz</button>
            </div>

            <div id="quizContainer" class="quiz-container hidden">
              <div class="quiz-header">
                <h4>AI Quiz</h4>
                <div class="quiz-timer">
                  <i class="fas fa-clock"></i>
                  <span id="quizTimer">02:00</span>
                </div>
              </div>
              
              <div class="quiz-progress">
                <div class="progress-dot" id="progress1"></div>
                <div class="progress-dot" id="progress2"></div>
              </div>
              
              <div class="quiz-question" id="quizQuestion">
                Loading question...
              </div>
              
              <div class="quiz-options" id="quizOptions">
                <!-- Options will be populated by JavaScript -->
              </div>
              
              <div class="quiz-navigation">
                <button class="quiz-btn" id="prevBtn" onclick="previousQuestion()" disabled>
                  <i class="fas fa-arrow-left"></i> Previous
                </button>
                <button class="quiz-btn" id="nextBtn" onclick="nextQuestion()">
                  Next <i class="fas fa-arrow-right"></i>
                </button>
                <button class="quiz-btn" id="submitBtn" onclick="submitQuiz()" style="display: none;">
                  <i class="fas fa-paper-plane"></i> Submit Quiz
                </button>
              </div>
            </div>

            <div id="quizResults" class="quiz-container hidden">
              <div class="quiz-results">
                <h4>Quiz Results</h4>
                <div class="quiz-score" id="quizScore">0/2</div>
                <div class="quiz-feedback" id="quizFeedback"></div>
                <div id="pointsEarned" class="points-earned" style="display: none;">+10 Points Earned</div>
                <div id="pointsLost" class="points-lost" style="display: none;">-10 Points Lost</div>
                <button class="auth-btn" onclick="resetQuiz()"><i class="fas fa-redo"></i> Try Again</button>
              </div>
            </div>
          </div>

          <!-- Offerwalls Page -->
          <div id="offerwalls" class="page hidden">
            <h3>Offerwalls</h3>
            <div id="offerwallList">
              <p>Loading offerwalls...</p>
            </div>
            <div id="iframeContainer" class="iframe-container hidden">
              <button class="close-iframe" onclick="closeIframe()">Ã—</button>
              <iframe id="offerwallFrame" class="offerwall-iframe" src="about:blank"></iframe>
            </div>
          </div>

          <!-- Cashout Page -->
          <div id="cashout" class="page hidden">
            <h3>Request Cashout</h3>
            <div class="cashout-info">
              <h4>Cashout Information</h4>
              <p>1 USD = 1000 PTS</p>
              <p>You only need USD balance to cash out</p>
            </div>
            <div class="cashout-form">
              <select id="rewardSelect" class="auth-input">
                <option value="">Choose reward...</option>
              </select>
              <button id="cashoutBtn" class="auth-btn" onclick="submitCashout()" disabled><i class="fas fa-coins"></i> Request Cashout</button>
            </div>

            <!-- Cashout History -->
            <div class="cashout-history">
              <h4>Cashout History</h4>
              <div id="cashoutHistory">
                <p>Loading history...</p>
              </div>
            </div>
          </div>

          <!-- Terms Page -->
          <div id="terms" class="page hidden">
            <div id="termsContent" style="text-align: left;"></div>
          </div>
        </div>
      </section>
    </div>
  </div>

  <!-- Chat System -->
  <button id="chatToggle" class="hidden"><i class="fas fa-comment-dots"></i></button>
  <div id="chatBox" class="hidden">
    <div class="chat-header">
      <span><i class="fas fa-headset"></i> Premium Support</span>
      <button class="chat-close" onclick="toggleChat()">Ã—</button>
    </div>
    <div class="chat-messages" id="chatMessages">
      <div class="chat-message other">
        <div class="message-sender">Insignia Support</div>
        Welcome to Insignia Premium! How can we assist you today?
      </div>
    </div>
    <div class="chat-input-container">
      <input type="text" class="chat-input" id="chatInput" placeholder="Type your message..." onkeypress="handleChatInput(event)">
      <button class="chat-send" onclick="sendChatMessage()"><i class="fas fa-paper-plane"></i></button>
    </div>
  </div>

  <!-- Alert Modal -->
  <div id="alertModal" class="hidden">
    <div class="modal">
      <p id="alertMessage">Message</p>
      <button onclick="closeAlert()">Continue</button>
    </div>
  </div>

  <!-- MAIN SCRIPT -->
  <script>
    // âš ï¸ REPLACE THIS WITH YOUR GOOGLE APPS SCRIPT DEPLOYMENT URL
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwTelvEYce1YEgw8-RDKth6xa_VJGRu2YOTxRMcgTGLuL6IXgO7tFG3xllYW4czAdbEEg/exec";

    let currentUser = null;
    let pendingUser = null;
    let chatInterval = null;
    
    // Quiz variables
    let currentQuiz = null;
    let currentQuestionIndex = 0;
    let userAnswers = [];
    let quizTimer = null;
    let timeRemaining = 120; // 2 minutes in seconds

    // Initialize the app
    async function init() {
      console.log('ðŸš€ Initializing Insignia...');
      
      // Enable anti-cheat protection
      enableAntiCheatProtection();
      
      try {
        // Test connection first
        const testResponse = await fetch(SCRIPT_URL + '?action=test');
        const testData = await testResponse.json();
        
        if (testData.status === 'success') {
          console.log('âœ… Connection test successful');
          
          // Load configuration
          const configResponse = await fetch(SCRIPT_URL + '?action=getConfig');
          const config = await configResponse.json();
          
          if (config.status === 'success') {
            applyConfig(config);
          }
          
          // Show app
          document.getElementById('loadingScreen').classList.add('hidden');
          document.getElementById('app').classList.remove('hidden');
          
          // Try auto-login - FIXED: Using quizbux_user to match your backend
          const saved = localStorage.getItem('quizbux_user');
          if (saved) {
            const userData = JSON.parse(saved);
            await restoreSession(userData.username);
          }
          
        } else {
          throw new Error('Connection test failed: ' + testData.message);
        }
        
      } catch (error) {
        console.error('âŒ Initialization failed:', error);
        showAlert('Failed to connect to server. Please check your internet connection and try again.');
        document.getElementById('loadingScreen').classList.add('hidden');
        document.getElementById('app').classList.remove('hidden');
      }
    }

    // Anti-cheat protection
    function enableAntiCheatProtection() {
      // Disable right-click context menu
      document.addEventListener('contextmenu', function(e) {
        e.preventDefault();
        showAntiCheatWarning();
        return false;
      });
      
      // Disable keyboard shortcuts for developer tools
      document.addEventListener('keydown', function(e) {
        // Disable F12, Ctrl+Shift+I, Ctrl+Shift+J, Ctrl+U
        if (e.keyCode === 123 || 
            (e.ctrlKey && e.shiftKey && e.keyCode === 73) || 
            (e.ctrlKey && e.shiftKey && e.keyCode === 74) ||
            (e.ctrlKey && e.keyCode === 85)) {
          e.preventDefault();
          showAntiCheatWarning();
          return false;
        }
      });
      
      // Detect if dev tools are open by checking window dimensions
      function checkDevTools() {
        const widthThreshold = window.outerWidth - window.innerWidth > 160;
        const heightThreshold = window.outerHeight - window.innerHeight > 160;
        
        if (widthThreshold || heightThreshold) {
          showAntiCheatWarning();
        }
      }
      
      // Check periodically
      setInterval(checkDevTools, 1000);
      
      // Override console methods during quiz
      const originalConsoleLog = console.log;
      const originalConsoleWarn = console.warn;
      const originalConsoleError = console.error;
      
      window.overrideConsole = function() {
        console.log = function() {};
        console.warn = function() {};
        console.error = function() {};
      };
      
      window.restoreConsole = function() {
        console.log = originalConsoleLog;
        console.warn = originalConsoleWarn;
        console.error = originalConsoleError;
      };
    }
    
    function showAntiCheatWarning() {
      document.getElementById('antiCheatOverlay').style.display = 'flex';
      if (quizTimer) {
        clearInterval(quizTimer);
        quizTimer = null;
      }
    }
    
    function closeAntiCheatOverlay() {
      document.getElementById('antiCheatOverlay').style.display = 'none';
      if (currentQuiz) {
        resetQuiz();
      }
    }

    // Apply configuration from Google Sheets
    function applyConfig(config) {
      console.log('Applying config:', config);
      
      // Update texts
      if (config.texts) {
        if (config.texts.welcome_message) {
          document.querySelector('#loginCard p').textContent = config.texts.welcome_message;
          document.querySelector('#signupCard p').textContent = config.texts.welcome_message;
        }
        
        if (config.texts.terms) {
          document.getElementById('termsContent').innerHTML = config.texts.terms;
        }
      }
      
      // Update app name
      if (config.app_name) {
        document.title = config.app_name + ' - Premium Rewards';
      }
      
      // Update logo
      if (config.logo) {
        document.getElementById('logo-img').src = config.logo;
      }
      
      // Update offers
      const select = document.getElementById('rewardSelect');
      select.innerHTML = '<option value="">Choose reward...</option>';
      
      if (config.offers && config.offers.length > 0) {
        config.offers.forEach(offer => {
          const option = document.createElement('option');
          option.value = offer.amount;
          option.textContent = `${offer.name} ($${offer.amount.toFixed(2)})`;
          select.appendChild(option);
        });
      }
      
      // Apply custom styles
      if (config.styles) {
        const styleElement = document.createElement('style');
        styleElement.textContent = config.styles;
        document.head.appendChild(styleElement);
      }
      
      // Apply custom scripts
      if (config.scripts) {
        const scriptElement = document.createElement('script');
        scriptElement.textContent = config.scripts;
        document.body.appendChild(scriptElement);
      }
    }

    // Auth functions
    function showLogin() {
      document.getElementById('signupCard').classList.add('hidden');
      document.getElementById('verifyCard').classList.add('hidden');
      document.getElementById('loginCard').classList.remove('hidden');
    }

    function showSignup() {
      document.getElementById('loginCard').classList.add('hidden');
      document.getElementById('verifyCard').classList.add('hidden');
      document.getElementById('signupCard').classList.remove('hidden');
    }

    function showVerification() {
      document.getElementById('loginCard').classList.add('hidden');
      document.getElementById('signupCard').classList.add('hidden');
      document.getElementById('verifyCard').classList.remove('hidden');
      document.querySelectorAll('.code-input').forEach(input => input.value = '');
      document.querySelector('.code-input').focus();
    }

    function moveToNext(input, nextIndex) {
      if (input.value.length === 1) {
        const nextInput = document.querySelectorAll('.code-input')[nextIndex];
        if (nextInput) nextInput.focus();
      }
    }

    async function signup() {
      const username = document.getElementById('signupUsername').value.trim();
      const email = document.getElementById('signupEmail').value.trim();
      const password = document.getElementById('signupPassword').value;

      if (!username || !email || !password) {
        return showAlert('Please fill all fields');
      }

      if (username.length < 3) {
        return showAlert('Username must be at least 3 characters');
      }

      if (password.length < 6) {
        return showAlert('Password must be at least 6 characters');
      }

      const formData = new FormData();
      formData.append('action', 'signup');
      formData.append('username', username);
      formData.append('email', email);
      formData.append('password', password);

      try {
        const response = await fetch(SCRIPT_URL, { method: 'POST', body: formData });
        const data = await response.json();

        if (data.status === 'success') {
          pendingUser = { username, email, password };
          showVerification();
          showAlert('Verification code sent to your email!');
        } else {
          showAlert(data.message || 'Signup failed');
        }
      } catch (error) {
        console.error('Signup error:', error);
        showAlert('Network error. Please try again.');
      }
    }

    async function verifyEmail() {
      const codeInputs = document.querySelectorAll('.code-input');
      const code = Array.from(codeInputs).map(input => input.value).join('');

      if (code.length !== 6) {
        return showAlert('Please enter the 6-digit code');
      }

      const formData = new FormData();
      formData.append('action', 'verifyEmail');
      formData.append('username', pendingUser.username);
      formData.append('email', pendingUser.email);
      formData.append('password', pendingUser.password);
      formData.append('code', code);

      try {
        const response = await fetch(SCRIPT_URL, { method: 'POST', body: formData });
        const data = await response.json();

        if (data.status === 'success') {
          showAlert('Account verified successfully! You can now login.');
          showLogin();
          pendingUser = null;
        } else {
          showAlert(data.message || 'Verification failed');
        }
      } catch (error) {
        console.error('Verification error:', error);
        showAlert('Network error. Please try again.');
      }
    }

    async function resendCode() {
      if (!pendingUser) return;

      const formData = new FormData();
      formData.append('action', 'resendCode');
      formData.append('username', pendingUser.username);
      formData.append('email', pendingUser.email);

      try {
        const response = await fetch(SCRIPT_URL, { method: 'POST', body: formData });
        const data = await response.json();

        if (data.status === 'success') {
          showAlert('New verification code sent!');
        } else {
          showAlert(data.message || 'Failed to resend code');
        }
      } catch (error) {
        console.error('Resend code error:', error);
        showAlert('Network error. Please try again.');
      }
    }

    async function login() {
      const username = document.getElementById('loginUsername').value.trim();
      const password = document.getElementById('loginPassword').value;

      if (!username || !password) {
        return showAlert('Please fill all fields');
      }

      const formData = new FormData();
      formData.append('action', 'login');
      formData.append('username', username);
      formData.append('password', password);

      try {
        const response = await fetch(SCRIPT_URL, { method: 'POST', body: formData });
        const data = await response.json();

        if (data.status === 'success') {
          currentUser = data.user;
          // FIXED: Using quizbux_user to match your backend
          localStorage.setItem('quizbux_user', JSON.stringify({ username }));
          showDashboard();
          loadOfferwalls();
          loadCashoutHistory();
          showAlert('Login successful! Welcome to Insignia.');
        } else {
          showAlert(data.message || 'Login failed');
        }
      } catch (error) {
        console.error('Login error:', error);
        showAlert('Network error. Please check your connection and try again.');
      }
    }

    async function restoreSession(username) {
      try {
        const response = await fetch(SCRIPT_URL + '?action=getUserData&username=' + encodeURIComponent(username));
        const data = await response.json();
        
        if (data.status === 'success') {
          currentUser = data.user;
          showDashboard();
          loadOfferwalls();
          loadCashoutHistory();
        } else {
          // FIXED: Using quizbux_user to match your backend
          localStorage.removeItem('quizbux_user');
        }
      } catch (error) {
        console.error('Restore session error:', error);
        // FIXED: Using quizbux_user to match your backend
        localStorage.removeItem('quizbux_user');
      }
    }

    function showDashboard() {
      document.getElementById('authScreens').classList.add('hidden');
      document.getElementById('dashboard').classList.remove('hidden');
      document.getElementById('chatToggle').classList.remove('hidden');

      document.getElementById('displayUsername').textContent = currentUser.username;
      document.getElementById('userAvatar').textContent = currentUser.username[0].toUpperCase();
      document.getElementById('balanceValue').textContent = Number(currentUser.balance).toLocaleString();
      document.getElementById('usdBalanceValue').textContent = '$' + Number(currentUser.balanceUSD).toFixed(4);

      // Update user status
      const statusElement = document.getElementById('userStatus');
      statusElement.textContent = currentUser.status || 'Premium';
      statusElement.className = `user-status status-${(currentUser.status || 'active').toLowerCase()}`;

      showPage('quiz');
    }

    function showPage(id) {
      document.querySelectorAll('.page').forEach(p => p.classList.add('hidden'));
      document.getElementById(id).classList.remove('hidden');
      
      // Update active nav button
      document.querySelectorAll('.nav button').forEach(btn => btn.classList.remove('active'));
      document.querySelector(`.nav button[onclick="showPage('${id}')"]`).classList.add('active');
      
      if (id === 'offerwalls') loadOfferwalls();
      if (id === 'cashout') loadCashoutHistory();
    }

    // Quiz Functions
    async function startQuiz() {
      if (!currentUser) return;
      
      // Override console to prevent cheating
      overrideConsole();
      
      try {
        // In a real implementation, this would call your backend
        // For now, we'll use mock data
        const mockQuiz = {
          id: 'quiz_' + Date.now(),
          questions: [
            {
              question: "What is the primary purpose of the 'this' keyword in JavaScript?",
              options: [
                "To refer to the current function",
                "To refer to the current object context",
                "To create a new variable",
                "To reference the parent function"
              ],
              correctAnswer: 1
            },
            {
              question: "Which of these is NOT a JavaScript data type?",
              options: [
                "String",
                "Boolean",
                "Character",
                "Undefined"
              ],
              correctAnswer: 2
            }
          ]
        };
        
        currentQuiz = mockQuiz;
        currentQuestionIndex = 0;
        userAnswers = [];
        
        // Show quiz container and hide intro
        document.getElementById('quizIntro').classList.add('hidden');
        document.getElementById('quizContainer').classList.remove('hidden');
        document.getElementById('quizResults').classList.add('hidden');
        
        // Start timer
        startTimer();
        
        // Load first question
        loadQuestion(0);
        
      } catch (error) {
        console.error('Start quiz error:', error);
        showAlert('Failed to start quiz. Please try again.');
      }
    }
    
    function loadQuestion(index) {
      if (!currentQuiz || !currentQuiz.questions || index >= currentQuiz.questions.length) return;
      
      const question = currentQuiz.questions[index];
      document.getElementById('quizQuestion').textContent = question.question;
      
      const optionsContainer = document.getElementById('quizOptions');
      optionsContainer.innerHTML = '';
      
      question.options.forEach((option, i) => {
        const optionElement = document.createElement('div');
        optionElement.className = 'quiz-option';
        if (userAnswers[index] === i) {
          optionElement.classList.add('selected');
        }
        optionElement.onclick = () => selectOption(i);
        
        optionElement.innerHTML = `
          <div class="option-marker">${String.fromCharCode(65 + i)}</div>
          <div class="option-text">${option}</div>
        `;
        
        optionsContainer.appendChild(optionElement);
      });
      
      // Update progress dots
      updateProgressDots();
      
      // Update navigation buttons
      document.getElementById('prevBtn').disabled = index === 0;
      
      if (index === currentQuiz.questions.length - 1) {
        document.getElementById('nextBtn').style.display = 'none';
        document.getElementById('submitBtn').style.display = 'block';
      } else {
        document.getElementById('nextBtn').style.display = 'block';
        document.getElementById('submitBtn').style.display = 'none';
      }
    }
    
    function selectOption(optionIndex) {
      userAnswers[currentQuestionIndex] = optionIndex;
      
      // Update UI
      const options = document.querySelectorAll('.quiz-option');
      options.forEach((option, i) => {
        if (i === optionIndex) {
          option.classList.add('selected');
        } else {
          option.classList.remove('selected');
        }
      });
    }
    
    function previousQuestion() {
      if (currentQuestionIndex > 0) {
        currentQuestionIndex--;
        loadQuestion(currentQuestionIndex);
      }
    }
    
    function nextQuestion() {
      if (currentQuestionIndex < currentQuiz.questions.length - 1) {
        currentQuestionIndex++;
        loadQuestion(currentQuestionIndex);
      }
    }
    
    function updateProgressDots() {
      for (let i = 0; i < 2; i++) {
        const dot = document.getElementById(`progress${i+1}`);
        if (i === currentQuestionIndex) {
          dot.className = 'progress-dot active';
        } else if (i < currentQuestionIndex) {
          dot.className = 'progress-dot completed';
        } else {
          dot.className = 'progress-dot';
        }
      }
    }
    
    function startTimer() {
      timeRemaining = 120; // 2 minutes
      updateTimerDisplay();
      
      quizTimer = setInterval(() => {
        timeRemaining--;
        updateTimerDisplay();
        
        if (timeRemaining <= 0) {
          clearInterval(quizTimer);
          submitQuiz();
        }
      }, 1000);
    }
    
    function updateTimerDisplay() {
      const minutes = Math.floor(timeRemaining / 60);
      const seconds = timeRemaining % 60;
      const timerElement = document.getElementById('quizTimer');
      
      timerElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
      
      // Change color when time is running out
      if (timeRemaining <= 30) {
        timerElement.className = 'timer-danger';
      } else if (timeRemaining <= 60) {
        timerElement.className = 'timer-warning';
      } else {
        timerElement.className = '';
      }
    }
    
    async function submitQuiz() {
      if (!currentQuiz || !currentUser) return;
      
      // Stop timer
      if (quizTimer) {
        clearInterval(quizTimer);
        quizTimer = null;
      }
      
      // Check if all questions are answered
      if (userAnswers.length < currentQuiz.questions.length || userAnswers.some(a => a === undefined)) {
        showAlert('Please answer all questions before submitting');
        return;
      }
      
      // Calculate score
      let correctAnswers = 0;
      currentQuiz.questions.forEach((question, index) => {
        if (userAnswers[index] === question.correctAnswer) {
          correctAnswers++;
        }
      });
      
      // Calculate points (5 per correct answer, -5 per incorrect)
      const pointsEarned = (correctAnswers * 5) - ((currentQuiz.questions.length - correctAnswers) * 5);
      const usdEarned = correctAnswers === currentQuiz.questions.length ? 0.01 : 0;
      
      // Show results
      document.getElementById('quizContainer').classList.add('hidden');
      document.getElementById('quizResults').classList.remove('hidden');
      
      document.getElementById('quizScore').textContent = `${correctAnswers}/${currentQuiz.questions.length}`;
      
      if (pointsEarned > 0) {
        document.getElementById('quizFeedback').textContent = 'Great job! You passed the quiz.';
        document.getElementById('pointsEarned').style.display = 'block';
        document.getElementById('pointsEarned').textContent = `+${pointsEarned} Points Earned`;
        document.getElementById('pointsLost').style.display = 'none';
      } else {
        document.getElementById('quizFeedback').textContent = 'You need to answer both questions correctly to earn points.';
        document.getElementById('pointsEarned').style.display = 'none';
        document.getElementById('pointsLost').style.display = 'block';
        document.getElementById('pointsLost').textContent = `${pointsEarned} Points Lost`;
      }
      
      // In a real implementation, submit results to backend
      // For now, we'll update the UI directly
      if (pointsEarned > 0) {
        currentUser.balance = (parseInt(currentUser.balance) || 0) + pointsEarned;
        currentUser.balanceUSD = (parseFloat(currentUser.balanceUSD) || 0) + usdEarned;
        
        document.getElementById('balanceValue').textContent = Number(currentUser.balance).toLocaleString();
        document.getElementById('usdBalanceValue').textContent = '$' + Number(currentUser.balanceUSD).toFixed(4);
      }
      
      // Restore console
      restoreConsole();
    }
    
    function resetQuiz() {
      document.getElementById('quizResults').classList.add('hidden');
      document.getElementById('quizIntro').classList.remove('hidden');
      currentQuiz = null;
      currentQuestionIndex = 0;
      userAnswers = [];
    }

    // Existing functions for offerwalls, cashout, etc.
    async function loadOfferwalls() {
      if (!currentUser) return;
      
      try {
        // Mock offerwalls data
        const mockOfferwalls = [
          {
            id: 'wall1',
            name: 'Premium Offers',
            pointsRequired: 100,
            status: 'active',
            url: 'https://example.com/offerwall1'
          },
          {
            id: 'wall2',
            name: 'Survey Network',
            pointsRequired: 200,
            status: 'active',
            url: 'https://example.com/offerwall2'
          }
        ];
        
        const container = document.getElementById('offerwallList');
        container.innerHTML = '';
        
        mockOfferwalls.forEach(wall => {
          const hasEnoughPoints = (currentUser.balance || 0) >= (wall.pointsRequired || 0);
          const isUnlocked = hasEnoughPoints && (wall.status === 'active');
          
          const offerwallElement = document.createElement('div');
          offerwallElement.className = 'offerwall-item';
          offerwallElement.innerHTML = `
            <h4>${wall.name}</h4>
            <p>Complete offers to earn rewards</p>
            <div class="offerwall-requirements ${isUnlocked ? 'unlocked' : 'locked'}">
              ${isUnlocked ? 
                'âœ… Unlocked - Ready to earn!' : 
                `ðŸ”’ Requires ${wall.pointsRequired || 0} points to unlock (You have ${currentUser.balance || 0})`
              }
            </div>
            <div class="offerwall-buttons">
              <button onclick="openOfferwallInIframe('${wall.id}', '${wall.url}')" 
                      ${!isUnlocked ? 'disabled' : ''}>
                <i class="fas fa-play-circle"></i> Start Earning
              </button>
              <button onclick="window.open('${wall.url}', '_blank')" 
                      ${!isUnlocked ? 'disabled' : ''}>
                <i class="fas fa-external-link-alt"></i> Open Externally
              </button>
            </div>
          `;
          
          container.appendChild(offerwallElement);
        });
      } catch (error) {
        console.error('Load offerwalls error:', error);
        document.getElementById('offerwallList').innerHTML = '<p>Error loading offerwalls</p>';
      }
    }

    function openOfferwallInIframe(offerwallId, url) {
      const iframe = document.getElementById('offerwallFrame');
      const iframeContainer = document.getElementById('iframeContainer');
      const offerwallList = document.getElementById('offerwallList');
      
      iframe.src = url;
      iframeContainer.classList.remove('hidden');
      offerwallList.classList.add('hidden');
    }

    function closeIframe() {
      const iframeContainer = document.getElementById('iframeContainer');
      const offerwallList = document.getElementById('offerwallList');
      const iframe = document.getElementById('offerwallFrame');
      
      iframeContainer.classList.add('hidden');
      offerwallList.classList.remove('hidden');
      iframe.src = 'about:blank';
    }

    async function submitCashout() {
      if (!currentUser) return;

      const amount = document.getElementById('rewardSelect').value;
      if (!amount) return showAlert('Please select a reward');

      const reward = document.getElementById('rewardSelect').selectedOptions[0].text;

      // In a real implementation, submit to backend
      showAlert(`Cashout request submitted for ${reward}`);
      
      document.getElementById('rewardSelect').value = '';
      document.getElementById('cashoutBtn').disabled = true;
    }

    async function loadCashoutHistory() {
      if (!currentUser) return;
      
      try {
        // Mock cashout history
        const mockHistory = [
          {
            reward: 'PayPal $10',
            amount: 10,
            status: 'approved',
            date: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000),
            adminNotes: ''
          },
          {
            reward: 'Amazon $5',
            amount: 5,
            status: 'pending',
            date: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000),
            adminNotes: ''
          }
        ];
        
        const container = document.getElementById('cashoutHistory');
        container.innerHTML = '';
        
        mockHistory.forEach(item => {
          const historyItem = document.createElement('div');
          historyItem.className = 'cashout-item';
          historyItem.innerHTML = `
            <strong>${item.reward}</strong> - $${item.amount} 
            <span class="cashout-status status-${item.status.toLowerCase()}">${item.status}</span>
            <div style="font-size: 0.9rem; color: var(--text-tertiary); margin-top: 0.5rem;">
              ${item.date.toLocaleDateString()}
            </div>
            ${item.adminNotes ? `
              <div class="admin-notes">
                <strong>Admin Notes:</strong> ${item.adminNotes}
              </div>
            ` : ''}
          `;
          
          container.appendChild(historyItem);
        });
      } catch (error) {
        console.error('Load cashout history error:', error);
        document.getElementById('cashoutHistory').innerHTML = '<p>Error loading history</p>';
      }
    }

    // Chat system
    function toggleChat() {
      const chatBox = document.getElementById('chatBox');
      const chatToggle = document.getElementById('chatToggle');
      
      if (chatBox.classList.contains('hidden')) {
        chatBox.classList.remove('hidden');
        chatToggle.innerHTML = '<i class="fas fa-times"></i>';
        loadChatMessages();
        startChatPolling();
      } else {
        chatBox.classList.add('hidden');
        chatToggle.innerHTML = '<i class="fas fa-comment-dots"></i>';
        stopChatPolling();
      }
    }

    function handleChatInput(event) {
      if (event.key === 'Enter') {
        sendChatMessage();
      }
    }

    async function sendChatMessage() {
      if (!currentUser) return;

      const input = document.getElementById('chatInput');
      const message = input.value.trim();
      
      if (!message) return;
      
      // Add message to chat UI
      const chatMessages = document.getElementById('chatMessages');
      const messageElement = document.createElement('div');
      messageElement.className = 'chat-message own';
      messageElement.innerHTML = `
        <div class="message-sender">${currentUser.username}</div>
        ${message}
      `;
      chatMessages.appendChild(messageElement);
      chatMessages.scrollTop = chatMessages.scrollHeight;
      
      input.value = '';
    }

    function loadChatMessages() {
      // This would normally load from the backend
      // For now, we'll just ensure the welcome message is there
      const chatMessages = document.getElementById('chatMessages');
      if (chatMessages.children.length === 1) {
        const welcomeMessage = document.createElement('div');
        welcomeMessage.className = 'chat-message other';
        welcomeMessage.innerHTML = `
          <div class="message-sender">Insignia Support</div>
          Welcome to Insignia Premium! How can we assist you today?
        `;
        chatMessages.appendChild(welcomeMessage);
      }
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    function startChatPolling() {
      chatInterval = setInterval(loadChatMessages, 3000);
    }

    function stopChatPolling() {
      if (chatInterval) {
        clearInterval(chatInterval);
        chatInterval = null;
      }
    }

    function logout() {
      // FIXED: Using quizbux_user to match your backend
      localStorage.removeItem('quizbux_user');
      if (chatInterval) clearInterval(chatInterval);
      location.reload();
    }

    function showAlert(msg) {
      document.getElementById('alertMessage').textContent = msg;
      document.getElementById('alertModal').classList.remove('hidden');
    }

    function closeAlert() {
      document.getElementById('alertModal').classList.add('hidden');
    }

    // Initialize cashout button
    document.getElementById('rewardSelect').onchange = function() {
      document.getElementById('cashoutBtn').disabled = !this.value;
    };

    // Initialize cashout options
    function initCashoutOptions() {
      const select = document.getElementById('rewardSelect');
      select.innerHTML = '<option value="">Choose reward...</option>';
      
      const rewards = [
        { name: 'PayPal $10', amount: 10 },
        { name: 'Amazon $5', amount: 5 },
        { name: 'Steam $20', amount: 20 }
      ];
      
      rewards.forEach(reward => {
        const option = document.createElement('option');
        option.value = reward.amount;
        option.textContent = `${reward.name} ($${reward.amount.toFixed(2)})`;
        select.appendChild(option);
      });
    }

    // Initialize terms content
    function initTermsContent() {
      document.getElementById('termsContent').innerHTML = `
        <h4>Terms of Service</h4>
        <p>By using Insignia, you agree to the following terms:</p>
        <ul>
          <li>You must be at least 18 years old to participate</li>
          <li>You may only have one account per person</li>
          <li>Fraudulent activity will result in account suspension</li>
          <li>All rewards are subject to approval</li>
        </ul>
        
        <h4>Privacy Policy</h4>
        <p>We value your privacy and are committed to protecting your personal information.</p>
        <p>We collect only the information necessary to provide our services and never sell your data to third parties.</p>
      `;
    }

    // Start the app
    window.onload = function() {
      init();
      initCashoutOptions();
      initTermsContent();
    };
  </script>
</body>
</html>
